
-unless campaign.blank?
  - new_and_changed = campaign.new_and_changed
  - current_project = campaign.last_changed_craft

  - unless current_project.nil?
    #content_for_current_project.hidden
      %h3 Current Project
      .craft
        .name= link_to(current_project.name, craft_path(current_project))
        .clear
        -if new_and_changed[:new].include?("Ships/#{current_project.craft_type.upcase}/#{current_project.name}.craft")
          = "new"
        -else
          - changed = new_and_changed[:changed].include?("Ships/#{current_project.craft_type.upcase}/#{current_project.name}.craft")
          = changed ? "untracked changes" : "tracked"

          Number of versions:
          = current_project.history_count
          .message
            - commit = current_project.history.first
            .small{:onclick => "change_message(this, '#{commit.message}', #{current_project.id}, '#{commit.to_s}')"}
              = commit.message
            .message_form{:id => "message_form_for_#{commit.to_s}"}
          -version = current_project.history_count
          .left Revert to Previous Version:
          .left.with_margin
            - current_project.history[1..3].each_with_index do |prev_version, index|
              = link_to "V#{version -= 1}", :controller => "crafts", :action => "edit", :id => current_project.id, :sha_id => prev_version.sha
              -unless index.eql?(2)
                |
          .left
            - if current_project.history.size > 4
              |
              = link_to "more", craft_path(current_project)

          .clear


  .clear
  .vblk_2
  .grid_5.push_1
    = link_to_function "show deleted craft", "toggle_deleted_craft()", :class => 'toggle_deleted_craft_link'
  .clear
  - campaign.craft.group_by{|g| g.craft_type}.each do |type, crafts|
    .grid_5.push_1
      %h4= type
      - sort_by = "updated_at reverse"
      - reverse_order = sort_by.include?('reverse')
      - crafts = crafts.sort_by{|c| c.send(sort_by.sub("reverse", "").strip)}
      - crafts.reverse! if reverse_order
      - crafts.each do |craft|
        - next if craft.eql?(current_project)
        - craft.crafts_campaign = campaign
        .craft_container{:class => (craft.deleted? ? 'deleted_craft' : '')}
          .craft
            .name= link_to(craft.name, craft_path(craft))
            .clear
            .git_info
              - unless craft.deleted?
                -if new_and_changed[:new].include?("Ships/#{craft.craft_type.upcase}/#{craft.name}.craft")
                  = "new"
                -else
                  - changed = new_and_changed[:changed].include?("Ships/#{craft.craft_type.upcase}/#{craft.name}.craft")
                  = changed ? "untracked changes" : "tracked"

              -else
                deleted
            .history
              Number of versions:
              = craft.history_count
